<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Usage"><meta property="og:title" content="Usage"><meta property="og:description" content="List snapshots Use the list action to list all snapshots where the given file was modified.
zsd lists only snapshots where the given file was modified. You can adjust the number of days to scan with the -d flag.
main⟩ zsd main.go list scan the last 2 days for other file versions # | File changed | Snapshot | Snapshot age ---------------------------------------------------------------------------- 0 | 20 minutes | zfs-auto-snap_frequent-2020-07-12-14h00U | 18 minutes 1 | 34 minutes | zfs-auto-snap_frequent-2020-07-12-13h45U | 33 minutes 2 | 49 minutes | zfs-auto-snap_frequent-2020-07-12-13h30U | 48 minutes Show file content Use the cat action to show the file content from the given snapshot."><meta property="og:type" content="article"><meta property="og:url" content="https://j-keck.github.io/zsd/docs/usage/"><title>Usage | zsd</title><link rel=icon href=https://j-keck.github.io/zsd/favicon.png type=image/x-icon><link rel=stylesheet href=https://j-keck.github.io/zsd/book.min.66d2f6926159dd697150bdcd901eead56a7adc9408513ccb9ab553939262dd4c.css integrity="sha256-ZtL2kmFZ3WlxUL3NkB7q1Wp63JQIUTzLmrVTk5Ji3Uw="><script defer src=https://j-keck.github.io/zsd/fontawesome-all.min.js></script></head><body><input type=checkbox class=hidden id=menu-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=https://j-keck.github.io/zsd/><span>zsd</span></a></h2><ul><li><a href=https://j-keck.github.io/zsd/docs/install/>Installation</a></li><li><a href=https://j-keck.github.io/zsd/docs/usage/ class=active>Usage</a></li><li><a href=https://j-keck.github.io/zsd/docs/changelog/>Changelog</a></li><li><a href=https://j-keck.github.io/zsd/docs/contact-support/>Contact / Support</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://j-keck.github.io/zsd/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Usage</strong>
<label for=toc-control><img src=https://j-keck.github.io/zsd/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><input type=checkbox class=hidden id=toc-control><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#list-snapshots>List snapshots</a></li><li><a href=#show-file-content>Show file content</a></li><li><a href=#show-diff>Show diff</a></li><li><a href=#revert-a-change>Revert a change</a><ul><li></li></ul></li><li><a href=#restore-file>Restore file</a></li><li><a href=#grep-changes>Grep changes</a></li><li><a href=#flags>Flags</a></li></ul></nav></aside></header><article class=markdown><h2 id=list-snapshots>List snapshots</h2><p>Use the <code>list</code> action to list all snapshots where the
given file was modified.</p><p><code>zsd</code> lists only snapshots where the given file was modified.
You can adjust the number of days to scan with the <code>-d</code> flag.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text> main⟩ zsd main.go list
scan the last 2 days for other file versions
  # | File changed | Snapshot                                 | Snapshot age
----------------------------------------------------------------------------
  0 |   20 minutes | zfs-auto-snap_frequent-2020-07-12-14h00U |   18 minutes
  1 |   34 minutes | zfs-auto-snap_frequent-2020-07-12-13h45U |   33 minutes
  2 |   49 minutes | zfs-auto-snap_frequent-2020-07-12-13h30U |   48 minutes
</code></pre></div><h2 id=show-file-content>Show file content</h2><p>Use the <code>cat</code> action to show the file content from
the given snapshot.</p><blockquote class="book-hint info">You can use the snapshot number from the <code>list</code> output
or the snapshot name to select a snapshot.</blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text> # i use `head` here to keep the example short
 main⟩ zsd main.go cat 2 | head -5
package main

import (
	&#34;errors&#34;
	&#34;flag&#34;
</code></pre></div><h2 id=show-diff>Show diff</h2><p>To show a diff from the selected snapshot to the actual version
use the <code>diff</code> action.</p><blockquote class="book-hint info">You can use the snapshot number from the <code>list</code> output
or the snapshot name to select a snapshot.</blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text> # i use `head` here to keep the example short
 main⟩ zsd -no-color -diff-context-size 2 main.go diff 1  | head -30
Diff from the actual version to the version from: 2020-07-12 15:44:43.566374368 +0200 CEST
=============================
Chunk 0 - starting at line 43
-----------------------------
        fmt.Fprintf(os.Stderr, &#34;  revert  &lt;#|SNAPSHOT&gt; &lt;CHUNK_NR&gt;: revert the given chunk\n&#34;)
		fmt.Fprintf(os.Stderr, &#34;  restore &lt;#|SNAPSHOT&gt;           : restore the file from the given snapshot\n&#34;)
-       fmt.Fprintf(os.Stderr, &#34;  grep    &lt;PATTERN&gt;              : grep changed lines\n&#34;)
+       fmt.Fprintf(os.Stderr, &#34;  grep    &lt;PATTERN&gt;              : grep changes\n&#34;)
        fmt.Fprintf(os.Stderr, &#34;\nYou can use the snapshot number from the `list` output or the snapshot name to select a snapshot.\n&#34;)
		fmt.Fprintf(os.Stderr, &#34;\nProject home page: https://j-keck.github.io/zsd\n&#34;)

==============================
Chunk 1 - starting at line 264
------------------------------
        pattern := strings.ToLower(flag.Arg(2))

+       if !cliCfg.scriptingOutput {
+           fmt.Printf(&#34;scan the last %d days for other file versions\n&#34;, config.Get.DaysToScan)
+       }

        dr := scanner.NDaysBack(config.Get.DaysToScan, time.Now())
		sc := scanner.NewScanner(dr, &#34;auto&#34;, ds, zfs)

==============================
Chunk 2 - starting at line 272
------------------------------
        }
</code></pre></div><h2 id=revert-a-change>Revert a change</h2><p>You can revert a single change with the <code>revert</code> action.</p><h4 id=view-a-diff-to-the-backup-version>View a diff to the backup version</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>main⟩ zsd -diff-context-size 1 -no-color cache.go diff 0
Diff from the actual version to the version from: 2020-07-04 14:29:37.807643286 +0200 CEST
=============================
Chunk 0 - starting at line 13
-----------------------------
	j, err := json.Marshal(versions)
+	println(err)
	if err != nil {

=============================
Chunk 1 - starting at line 18
-----------------------------
	cacheDir, err := fs.CacheDir()
+	println(err)
	if err != nil {
</code></pre></div><h4 id=revert-a-single-change>Revert a single change</h4><p>Use the chunk-nr from the <code>diff</code> output to select the change to revert.
See the <strong><strong>Chunk &lt;NR></strong></strong> line to get it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>main⟩ ./zsd -diff-context-size 1 -no-color cache.go revert 0 1
backup from the actual version created at: /home/j/.cache/zfs-snap-diff/backups/home/j/prj/priv/zfs-snap-diff/zsd/cache.go_20200704_144023
reverted:
	cacheDir, err := fs.CacheDir()
+	println(err)
	if err != nil {
</code></pre></div><h4 id=check-the-result>Check the result</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>main⟩ zsd -diff-context-size 1 -no-color cache.go diff 0
Diff from the actual version to the version from: 2020-07-04 14:29:37.807643286 +0200 CEST
=============================
Chunk 0 - starting at line 13
-----------------------------
	j, err := json.Marshal(versions)
+	println(err)
	if err != nil {
</code></pre></div><blockquote class="book-hint warning">A backup of the current version will be created.</blockquote><h2 id=restore-file>Restore file</h2><p>To restore a given file with an older version use <code>restore</code>.</p><blockquote class="book-hint info">You can use the snapshot number from the <code>list</code> output
or the snapshot name to select a snapshot.</blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>main⟩ zsd go.mod restore 0
backup from the actual version created at: /home/j/.cache/zfs-snap-diff/backups/home/j/prj/priv/zfs-snap-diff/go.mod_20200212_182709%
version restored from snapshot: zfs-auto-snap_hourly-2020-02-12-12h00U
</code></pre></div><blockquote class="book-hint warning">A backup of the current version will be created.</blockquote><h2 id=grep-changes>Grep changes</h2><p>You can search changes with <code>grep &lt;PATTERN></code>. This search only changed lines.</p><p>To view the whole diff use the snapshot number or snapshot name from the output.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text> main⟩ zsd main.go grep trim
scan the last 2 days for other file versions
  # | File changed | Snapshot                                 | Snapshot age |  Line | Change
------------------------------------------------------------------------------------------------------------------------
  3 |      1 hours |   zfs-auto-snap_hourly-2020-07-12-13h00U |      2 hours |   285 | + line := strings.TrimSpace(line)
</code></pre></div><h2 id=flags>Flags</h2><p>Use the <code>-h</code> flag to see the supported flags.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>main⟩ zsd -h
zsd - cli tool to find older versions of a given file in your zfs snapshots.

USAGE:
 ./zsd [OPTIONS] &lt;FILE&gt; &lt;ACTION&gt;

OPTIONS:
  -H	Scripting mode. Do not print headers, print absolute dates and separate fields by a single tab
  -V	print version and exit
  -d int
        days to scan (default 2)
 -mount-snapshots
        mount snapshot (only necessary if it&#39;s not mounted by zfs automatically)
 -snapshot-timemachine
        Special output for Snapshot-timemachine (https://github.com/mrBliss/snapshot-timemachine)
 -use-sudo
        use sudo when executing &#39;zfs&#39; commands
  -v	debug output
  -vv
        trace output with caller location

ACTIONS:
  list                           : list zfs snapshots where the given file was modified
  cat     &lt;#|SNAPSHOT&gt;           : show the file content from the given snapshot
  diff    &lt;#|SNAPSHOT&gt;           : show a diff from the selected snapshot to the current version
  revert  &lt;#|SNAPSHOT&gt; &lt;CHUNK_NR&gt;: revert the given chunk
  restore &lt;#|SNAPSHOT&gt;           : restore the file from the given snapshot
  grep    &lt;PATTERN&gt;              : grep changes

You can use the snapshot number from the `list` output or the snapshot name to select a snapshot.

Project home page: https://j-keck.github.io/zsd
</code></pre></div></article><footer class=book-footer><div class="flex justify-between"></div><div class=book-comments></div></footer></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#list-snapshots>List snapshots</a></li><li><a href=#show-file-content>Show file content</a></li><li><a href=#show-diff>Show diff</a></li><li><a href=#revert-a-change>Revert a change</a><ul><li></li></ul></li><li><a href=#restore-file>Restore file</a></li><li><a href=#grep-changes>Grep changes</a></li><li><a href=#flags>Flags</a></li></ul></nav></aside></main><a href=https://github.com/j-keck/zsd class=github-corner aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media(max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></body></html>